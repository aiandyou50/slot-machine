---
document_type: Architecture Document
version: 1.0
last_updated: 2025-10-11
status: final
ai_optimized: true
estimated_read_time: 20 min
priority_sections:
  - section_3: design_rules (AI MUST FOLLOW)
---

# CandleSpinner: Software Architecture Document

## 1. Overview

(KO) ì´ ë¬¸ì„œëŠ” 'CandleSpinner' í”„ë¡œì íŠ¸ì˜ ê¸°ìˆ ì  ì•„í‚¤í…ì²˜ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. ì‹œìŠ¤í…œì˜ êµ¬ì¡°, êµ¬ì„± ìš”ì†Œ, ë°ì´í„° íë¦„, API ëª…ì„¸ ë“±ì„ ìƒì„¸íˆ ê¸°ìˆ í•˜ì—¬ ì¼ê´€ì„± ìˆëŠ” ê°œë°œì„ ìœ„í•œ ê¸°ìˆ ì  ì²­ì‚¬ì§„ì„ ì œê³µí•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.
(EN) This document defines the technical architecture for the 'CandleSpinner' project. It aims to provide a technical blueprint for consistent development by detailing the system structure, components, data flow, and API specifications.

---

## 2. Core Philosophy

(KO)
- **ì„œë²„ë¦¬ìŠ¤ ìš°ì„  (Serverless-First):** ëª¨ë“  ì¸í”„ë¼ëŠ” Cloudflareë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ êµ¬ì¶•í•˜ì—¬, ë³„ë„ì˜ ì„œë²„ ê´€ë¦¬ ì—†ì´ ë†’ì€ í™•ì¥ì„±ê³¼ ë¹„ìš© íš¨ìœ¨ì„±ì„ ì¶”êµ¬í•©ë‹ˆë‹¤.
- **ë¹„ìˆ˜íƒí˜• ìì‚° ê´€ë¦¬ (Non-Custodial):** ì‚¬ìš©ìì˜ ìì‚°ì€ í•­ìƒ ì‚¬ìš©ìì˜ ì§€ê°‘ì— ë‚¨ì•„ìˆìœ¼ë©°, í”„ë¡œì íŠ¸ëŠ” ìì‚°ì„ ì§ì ‘ ë³´ê´€í•˜ê±°ë‚˜ í†µì œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- **ìƒíƒœ ë¹„ì €ì¥ ë°±ì—”ë“œ (Stateless Backend):** ê° API í•¨ìˆ˜ëŠ” ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©° ìƒíƒœë¥¼ ì €ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ìƒíƒœ ê´€ë¦¬ê°€ í•„ìš”í•œ ê²½ìš°(ì˜ˆ: ì¤‘ë³µ ì§€ê¸‰ ë°©ì§€, Commit-Reveal) JWTì™€ Cloudflare KVë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **ë‹¨ì¼ ì§„ì‹¤ ê³µê¸‰ì› (Single Source of Truth):** ëª¨ë“  ìš”êµ¬ì‚¬í•­ê³¼ ì•„í‚¤í…ì²˜ ì •ë³´ëŠ” `docs` í´ë” ë‚´ì˜ ë¬¸ì„œë“¤ì„ í†µí•´ ê´€ë¦¬ë©ë‹ˆë‹¤.

(EN)
- **Serverless-First:** All infrastructure is built around Cloudflare, aiming for high scalability and cost-effectiveness without server management.
- **Non-Custodial Asset Management:** User assets always remain in the user's own wallet; the project does not store or control them directly.
- **Stateless Backend:** Each API function executes independently and does not store state. State management (e.g., preventing duplicate payouts, Commit-Reveal) is handled using JWT and Cloudflare KV.
- **Single Source of Truth:** All requirements and architectural information are managed through documents in the `docs` folder.

---

## 3. ì„¤ê³„ ê·œì¹™ (Design Rules - AI MUST FOLLOW)

> **ì¤‘ìš”:** ì´ ê·œì¹™ë“¤ì€ ì ˆëŒ€ì ì…ë‹ˆë‹¤. ìœ„ë°˜ ì‹œ PR ìë™ ê±°ë¶€.

### ê·œì¹™ 1 (ê³µì •ì„±): í™•ë¥  ë¡œì§ì€ Commit-Revealë§Œ ì‚¬ìš©

- **ì ìš© ëŒ€ìƒ:** ìŠ¤í•€ ê²°ê³¼, ë”ë¸”ì—… ìŠ¹/íŒ¨, ëª¨ë“  ëœë¤ ì´ë²¤íŠ¸
- **ê¸ˆì§€:** `Math.random()`, `Date.now() % 2`, ì„œë²„ ë‹¨ë… ê²°ì •
- **í•„ìˆ˜:** Commit ë‹¨ê³„ â†’ ì‚¬ìš©ì ì…ë ¥ â†’ Reveal ë‹¨ê³„
- **ê²€ì¦ ë°©ë²•:**
  ```bash
  grep -r "Math.random()" functions/
  # ê²°ê³¼: 0ê°œ (ì„±ê³µ)
  ```
- **ê´€ë ¨ ADR:** ADR-001 (Commit-Reveal ë„ì…)
- **ì˜ˆì™¸:** ì—†ìŒ

### ê·œì¹™ 2 (ë³´ì•ˆ): í™˜ê²½ ë³€ìˆ˜ ì™¸ ë¹„ë°€ ì •ë³´ ê¸ˆì§€

- **ì ìš© ëŒ€ìƒ:** JWT_SECRET, GAME_WALLET_SEED, API_KEY
- **ê¸ˆì§€:** í•˜ë“œì½”ë”©, ëŒ€ì²´ ê°’(fallback), ì£¼ì„ì— í¬í•¨
- **í•„ìˆ˜:** `env.XXX` ë˜ëŠ” ì¦‰ì‹œ ì‹¤íŒ¨
- **ê²€ì¦ ë°©ë²•:**
  ```javascript
  // âŒ ì˜ëª»ëœ ì˜ˆì‹œ
  const secret = env.JWT_SECRET || "default-secret";
  
  // âœ… ì˜¬ë°”ë¥¸ ì˜ˆì‹œ
  const secret = env.JWT_SECRET;
  if (!secret) throw new Error("JWT_SECRET required");
  ```
- **ê´€ë ¨ ADR:** ì—†ìŒ (ê¸°ë³¸ ë³´ì•ˆ ì •ì±…)

### ê·œì¹™ 3 (ì˜ì¡´ì„±): @tonconnect/uiëŠ” NPM ë²ˆë“¤ë§

- **ì ìš© ëŒ€ìƒ:** `@tonconnect/ui` ë¼ì´ë¸ŒëŸ¬ë¦¬
- **ê¸ˆì§€:** CDN ë¡œë“œ (`<script src="https://..."`)
- **í•„ìˆ˜:** `npm install @tonconnect/ui` í›„ ë²ˆë“¤ë§
- **ê²€ì¦ ë°©ë²•:**
  ```bash
  grep "unpkg.com/@tonconnect" index.html
  # ê²°ê³¼: 0ê°œ (ì„±ê³µ)
  ```
- **ê´€ë ¨ ADR:** ADR-003 (í•˜ì´ë¸Œë¦¬ë“œ ì˜ì¡´ì„± ëª¨ë¸)
- **ì´ìœ :** CDN ë¶ˆì•ˆì •ìœ¼ë¡œ ì¸í•œ ë Œë”ë§ ì‹¤íŒ¨ ë°©ì§€

### ê·œì¹™ 4 (ë¸”ë¡ì²´ì¸): ì ¯ìŠ¨ ì£¼ì†ŒëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ ê³„ì‚°

- **ì ìš© ëŒ€ìƒ:** ì‚¬ìš©ìì˜ Jetton ì§€ê°‘ ì£¼ì†Œ ì¡°íšŒ
- **ê¸ˆì§€:** 
  - `/getJettonWalletAddress` API í˜¸ì¶œ (íê¸°ë¨)
  - `tonClient.runMethod()` ì„œë²„ í˜¸ì¶œ
- **í•„ìˆ˜:** `@ton/core`ì˜ `beginCell()` ì‚¬ìš©í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ ê³„ì‚°
- **ê²€ì¦ ë°©ë²•:**
  ```javascript
  // âœ… ì˜¬ë°”ë¥¸ ì˜ˆì‹œ (blockchain.js)
  import { beginCell, Address } from '@ton/core';
  
  function calculateJettonWallet(ownerAddress, jettonMaster) {
    const stateInit = ... // í‘œì¤€ Jetton ì§€ê°‘ StateInit
    const address = contractAddress(0, stateInit);
    return address;
  }
  ```
- **ê´€ë ¨ ADR:** ADR-002 (ë°±ì—”ë“œ RPC í”„ë¡ì‹œ - íê¸°ë¨)
- **ì´ìœ :** ì„œë²„ RPCì˜ ë¶ˆì•ˆì •ì„± ë° exit_code -13 ì˜¤ë¥˜ ë°©ì§€

### ê·œì¹™ 5 (íŠ¸ëœì­ì…˜ ê²€ì¦): íŠ¸ëœì­ì…˜ì€ ë°œì‹ ì ê²€ì¦ í•„ìˆ˜

- **ì ìš© ëŒ€ìƒ:** `/revealSpin`, `/claimPrize` ë“± ëª¨ë“  BOC ì²˜ë¦¬
- **ê¸ˆì§€:** BOC ë‚´ìš©ë§Œ ì‹ ë¢°
- **í•„ìˆ˜:** BOCë¥¼ íŒŒì‹±í•˜ì—¬ ë°œì‹ ì ì£¼ì†Œ í™•ì¸ í›„ ìš”ì²­ìì™€ ëŒ€ì¡°
- **ê²€ì¦ ë°©ë²•:**
  ```javascript
  // âœ… ì˜¬ë°”ë¥¸ ì˜ˆì‹œ (revealSpin.js)
  import { Cell } from '@ton/core';
  
  const boc = Cell.fromBase64(request.boc);
  const parsedTx = parseTransaction(boc);
  const sender = parsedTx.sender;
  
  if (sender !== request.userAddress) {
    return { error: "INVALID_SENDER" };
  }
  ```
- **ê´€ë ¨ ADR:** ADR-004 (íŠ¸ëœì­ì…˜ ê²€ì¦ ê°•í™”)
- **ì´ìœ :** ìœ„ì¡° í‹°ì¼“ ë°©ì§€

---

## 3.5. ê·œì¹™ ì¤€ìˆ˜ ìë™ ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸

ë‹¤ìŒ ìŠ¤í¬ë¦½íŠ¸ë¥¼ `.git/hooks/pre-commit`ì— ì¶”ê°€í•˜ê±°ë‚˜ CI/CDì—ì„œ ì‹¤í–‰:

```bash
#!/bin/bash

echo "ğŸ” ì„¤ê³„ ê·œì¹™ ê²€ì¦ ì¤‘..."

# ê·œì¹™ 1: Math.random() ê²€ì‚¬
if grep -r "Math.random()" functions/ src/ 2>/dev/null; then
  echo "âŒ ê·œì¹™ 1 ìœ„ë°˜: Math.random() ì‚¬ìš© ê¸ˆì§€"
  exit 1
fi

# ê·œì¹™ 2: í™˜ê²½ ë³€ìˆ˜ í•˜ë“œì½”ë”© ê²€ì‚¬
if grep -rE "(JWT_SECRET|GAME_WALLET_SEED).*=.*['\"]" functions/ 2>/dev/null; then
  echo "âŒ ê·œì¹™ 2 ìœ„ë°˜: ë¹„ë°€ í‚¤ í•˜ë“œì½”ë”© ê¸ˆì§€"
  exit 1
fi

# ê·œì¹™ 3: CDN ì‚¬ìš© ê²€ì‚¬
if grep "unpkg.com/@tonconnect" index.html 2>/dev/null; then
  echo "âŒ ê·œì¹™ 3 ìœ„ë°˜: @tonconnect/ui CDN ì‚¬ìš© ê¸ˆì§€"
  exit 1
fi

# ê·œì¹™ 4: RPC í”„ë¡ì‹œ í˜¸ì¶œ ê²€ì‚¬
if grep -r "/getJettonWalletAddress" src/ 2>/dev/null; then
  echo "âŒ ê·œì¹™ 4 ìœ„ë°˜: íê¸°ëœ RPC í”„ë¡ì‹œ ì‚¬ìš© ê¸ˆì§€"
  exit 1
fi

echo "âœ… ëª¨ë“  ì„¤ê³„ ê·œì¹™ ì¤€ìˆ˜ í™•ì¸"
```

---

## 4. System Diagram

(KO) ì•„ë˜ëŠ” ì‹œìŠ¤í…œì˜ ì£¼ìš” êµ¬ì„± ìš”ì†Œì™€ ìƒí˜¸ì‘ìš©ì„ ë‚˜íƒ€ë‚´ëŠ” ë‹¤ì´ì–´ê·¸ë¨ì…ë‹ˆë‹¤.
(EN) Below is a diagram showing the main components of the system and their interactions.

```mermaid
sequenceDiagram
    participant User as ì‚¬ìš©ì (User)
    participant Browser as í”„ë¡ íŠ¸ì—”ë“œ (Frontend)
    participant Functions as Cloudflare Functions (Backend)
    participant KV as Cloudflare KV
    participant TON as TON Blockchain

    User->>Browser: 1. ì§€ê°‘ ì—°ê²° (Connect Wallet)
    Browser->>TON: @tonconnect/ui ì‚¬ìš©
    TON-->>Browser: ì§€ê°‘ ì£¼ì†Œ ë°˜í™˜

    User->>Browser: 2. ìŠ¤í•€ ë²„íŠ¼ í´ë¦­ (Click Spin)
    Browser->>Functions: 3. GET /commitSpin (Commit)
    Functions->>Functions: ì„œë²„ ì‹œë“œ ìƒì„± ë° í•´ì‹œ (serverSeed -> commitment)
    Functions->>KV: (commitment, serverSeed) 5ë¶„ê°„ ì €ì¥
    Functions-->>Browser: commitment ë°˜í™˜

    Browser->>Browser: 4. í´ë¼ì´ì–¸íŠ¸ ì‹œë“œ ìƒì„± (clientSeed)
    Browser->>Browser: 5. ì ¯ìŠ¨ ì§€ê°‘ ì£¼ì†Œ ê³„ì‚° (ê·œì¹™ 4)
    Browser->>TON: 6. CSPIN í† í° ì „ì†¡ íŠ¸ëœì­ì…˜ ìš”ì²­ (to Game Wallet)
    User->>TON: íŠ¸ëœì­ì…˜ ì„œëª…
    Browser->>TON: íŠ¸ëœì­ì…˜ ì „ì†¡ ë° í™•ì¸ (BOC íšë“)

    Browser->>Functions: 7. POST /revealSpin (commitment, clientSeed, boc)
    Functions->>TON: BOCë¥¼ í†µí•´ ë°œì‹ ì ì£¼ì†Œ í™•ì¸ (ê·œì¹™ 5)
    Functions->>KV: commitmentìœ¼ë¡œ serverSeed ì¡°íšŒ
    KV-->>Functions: serverSeed ë°˜í™˜
    Functions->>Functions: ê²°ê³¼ ê³„ì‚° (serverSeed, clientSeed) (ê·œì¹™ 1)
    Functions-->>Browser: 8. ê²Œì„ ê²°ê³¼ì™€ serverSeed ë°˜í™˜

    Browser->>Browser: 9. ê²°ê³¼ ê²€ì¦ (sha256(serverSeed) == commitment)
    Browser->>Browser: ì‚¬ìš©ìì—ê²Œ ê²°ê³¼ í‘œì‹œ
```

---

## 5. Technology Stack & Rationale

| Category | Technology | Rationale (KO) | Rationale (EN) |
| :--- | :--- | :--- | :--- |
| **Frontend** | **Vite** | ë¹ ë¥¸ ê°œë°œ ì„œë²„ì™€ ìµœì í™”ëœ ë¹Œë“œ ì„±ëŠ¥ì„ ì œê³µí•˜ì—¬ ê°œë°œ ìƒì‚°ì„±ì„ ë†’ì…ë‹ˆë‹¤. | Provides a fast development server and optimized build performance, increasing development productivity. |
| | **Vanilla JS/HTML/CSS** | ì™¸ë¶€ UI í”„ë ˆì„ì›Œí¬ì— ëŒ€í•œ ì˜ì¡´ì„± ì—†ì´ ê°€ë³ê³  ë¹ ë¥¸ ì‚¬ìš©ì ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤. | Delivers a lightweight and fast user experience without dependency on external UI frameworks. |
| **Backend** | **Cloudflare Functions** | ì„œë²„ ê´€ë¦¬ê°€ í•„ìš” ì—†ëŠ” ì„œë²„ë¦¬ìŠ¤ í™˜ê²½ì„ ì œê³µí•˜ë©°, ê¸€ë¡œë²Œ ì—£ì§€ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ë¹ ë¥¸ ì‘ë‹µ ì†ë„ë¥¼ ë³´ì¥í•©ë‹ˆë‹¤. | Offers a serverless environment requiring no server management and ensures fast response times via a global edge network. |
| **Hosting** | **Cloudflare Pages** | Git í‘¸ì‹œë¥¼ í†µí•´ ê°„í¸í•˜ê²Œ í”„ë¡ íŠ¸ì—”ë“œë¥¼ ë°°í¬í•˜ê³ , Functionsì™€ ì™„ë²½í•˜ê²Œ í†µí•©ë©ë‹ˆë‹¤. | Easily deploys the frontend via Git push and integrates seamlessly with Functions. |
| **Blockchain** | **TON (The Open Network)** | ë‚®ì€ ìˆ˜ìˆ˜ë£Œì™€ ë¹ ë¥¸ íŠ¸ëœì­ì…˜ ì†ë„ë¥¼ ì œê³µí•˜ë©°, Telegramê³¼ì˜ ì—°ë™ì„ í†µí•´ ë†’ì€ ì ‘ê·¼ì„±ì„ ê°€ì§‘ë‹ˆë‹¤. | Offers low fees, fast transaction speeds, and high accessibility through its integration with Telegram. |
| **Libraries** | **@tonconnect/ui** | TON ì§€ê°‘ ì—°ê²°ì„ ìœ„í•œ ê³µì‹ UI ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ, ë‹¤ì–‘í•œ ì§€ê°‘ê³¼ì˜ í˜¸í™˜ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤. | The official UI library for TON wallet connections, ensuring compatibility with various wallets. |
| | **@ton/core, @ton/ton** | TON ë¸”ë¡ì²´ì¸ ìƒí˜¸ì‘ìš©ì„ ìœ„í•œ ìµœì‹  ê³µì‹ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ, ì•ˆì •ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤. | The latest official libraries for TON blockchain interaction, ensuring stability and maintainability. |
| | **jose** | ë°±ì—”ë“œì—ì„œ ìƒíƒœ ë¹„ì €ì¥ "ë‹¹ì²¨ í‹°ì¼“"ì„ ì•ˆì „í•˜ê²Œ ìƒì„±í•˜ê³  ê²€ì¦í•˜ê¸° ìœ„í•œ í‘œì¤€ JWT ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. | A standard JWT library for securely creating and verifying stateless "win tickets" on the backend. |
| **Storage** | **Cloudflare KV** | Commit-Reveal ìŠ¤í‚´ì˜ `(commitment, serverSeed)` ìŒê³¼ ê°™ì´, ì§§ì€ ë§Œë£Œ ì‹œê°„ì„ ê°–ëŠ” í‚¤-ê°’ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ ê¸€ë¡œë²Œ ì €ì§€ì—° ìŠ¤í† ë¦¬ì§€ì…ë‹ˆë‹¤. | A global, low-latency key-value store for short-lived data like the `(commitment, serverSeed)` pair in the Commit-Reveal scheme. |

---

## 6. Directory Structure

```
.
â”œâ”€â”€ docs/                   # (KO) ëª¨ë“  í”„ë¡œì íŠ¸ ë¬¸ì„œ (EN) All project documents
â”‚   â”œâ”€â”€ adr/                # (KO) ì•„í‚¤í…ì²˜ ê²°ì • ê¸°ë¡ (EN) Architecture Decision Records
â”‚   â””â”€â”€ reports/            # (KO) ë¶„ì„ ë° ê°œì„  ë³´ê³ ì„œ (EN) Analysis and improvement reports
â”œâ”€â”€ functions/              # (KO) Cloudflare Functions (ë°±ì—”ë“œ API) (EN) Cloudflare Functions (Backend API)
â”‚   â”œâ”€â”€ commitSpin.js
â”‚   â”œâ”€â”€ revealSpin.js
â”‚   â”œâ”€â”€ claimPrize.js
â”‚   â””â”€â”€ doubleUp.js
â”œâ”€â”€ public/                 # (KO) ì •ì  ì—ì…‹ (ì´ë¯¸ì§€, í°íŠ¸, ì–¸ì–´ íŒŒì¼) (EN) Static assets (images, fonts, language files)
â”‚   â”œâ”€â”€ lang/
â”‚   â”‚   â”œâ”€â”€ en.json
â”‚   â”‚   â””â”€â”€ ko.json
â”‚   â””â”€â”€ icon.png
â”œâ”€â”€ src/                    # (KO) í”„ë¡ íŠ¸ì—”ë“œ ì†ŒìŠ¤ ì½”ë“œ (EN) Frontend source code
â”‚   â”œâ”€â”€ services/           # (KO) ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™ ë¡œì§ (EN) Logic for external service integration
â”‚   â”‚   â”œâ”€â”€ api.js          # (KO) ë°±ì—”ë“œ API í˜¸ì¶œ (EN) Backend API calls
â”‚   â”‚   â””â”€â”€ blockchain.js   # (KO) TON ë¸”ë¡ì²´ì¸ ìƒí˜¸ì‘ìš© (EN) TON blockchain interactions
â”‚   â”œâ”€â”€ main.js             # (KO) ì• í”Œë¦¬ì¼€ì´ì…˜ ì§„ì…ì  (EN) Application entry point
â”‚   â””â”€â”€ style.css           # (KO) ê¸°ë³¸ ìŠ¤íƒ€ì¼ì‹œíŠ¸ (EN) Base stylesheet
â”œâ”€â”€ .gitignore
â”œâ”€â”€ _routes.json            # (KO) Cloudflare Pages ë¼ìš°íŒ… ê·œì¹™ (EN) Cloudflare Pages routing rules
â”œâ”€â”€ index.html              # (KO) ë©”ì¸ HTML íŒŒì¼ (EN) Main HTML file
â”œâ”€â”€ package.json            # (KO) í”„ë¡œì íŠ¸ ì˜ì¡´ì„± ë° ìŠ¤í¬ë¦½íŠ¸ (EN) Project dependencies and scripts
â”œâ”€â”€ vite.config.js          # (KO) Vite ë¹Œë“œ ì„¤ì • (EN) Vite build configuration
â””â”€â”€ wrangler.toml           # (KO) Cloudflare Functions ì„¤ì • (EN) Cloudflare Functions configuration
```

---

## 7. API Endpoint Specification

### 7.1. GET /commitSpin

- **(KO) ì„¤ëª…:** Commit-Reveal ìŠ¤í‚´ì˜ 'Commit' ë‹¨ê³„ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì„œë²„ ì‹œë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ í•´ì‹œ(commitment)ë¥¼ ìƒì„±í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤.
- **(EN) Description:** Performs the 'Commit' phase of the Commit-Reveal scheme. Generates and returns a hash (commitment) based on a server seed.
- **Request Body:** None

**Example Request:**
```bash
curl https://candlespinner.pages.dev/commitSpin
```

**Success Response:**
```json
{
  "success": true,
  "commitment": "a1b2c3d4e5f6..." // (KO) ì„œë²„ ì‹œë“œì˜ SHA-256 í•´ì‹œ (EN) SHA-256 hash of server seed
}
```

**Error Response:**
```json
{
  "success": false,
  "errorCode": "KV_ERROR | INTERNAL_SERVER_ERROR",
  "message": "string"
}
```

---

### 7.2. POST /revealSpin

- **(KO) ì„¤ëª…:** Commit-Reveal ìŠ¤í‚´ì˜ 'Reveal' ë‹¨ê³„ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ë² íŒ…ì„ ê²€ì¦í•˜ê³ , ì„œë²„/í´ë¼ì´ì–¸íŠ¸ ì‹œë“œë¥¼ ì¡°í•©í•˜ì—¬ ìµœì¢… ê²°ê³¼ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
- **(EN) Description:** Performs the 'Reveal' phase of the Commit-Reveal scheme. Validates the user's bet and combines server/client seeds to return the final result.

**Example Request:**
```bash
curl -X POST https://candlespinner.pages.dev/revealSpin \
  -H "Content-Type: application/json" \
  -d '{
    "commitment": "a1b2c3d4e5f6...",
    "clientSeed": "x9y8z7...",
    "boc": "te6cc...",
    "betAmount": 10,
    "userAddress": "UQB..."
  }'
```

**Request Body:**
```json
{
  "commitment": "string",  // (KO) /commitSpinì—ì„œ ë°›ì€ í•´ì‹œ (EN) Hash received from /commitSpin
  "clientSeed": "string",  // (KO) í´ë¼ì´ì–¸íŠ¸ê°€ ìƒì„±í•œ ì‹œë“œ (EN) Seed generated by the client
  "boc": "string",         // (KO) ì‚¬ìš©ìê°€ ì„œëª…í•œ íŠ¸ëœì­ì…˜ì˜ Base64 BOC (EN) Base64 BOC of user-signed transaction
  "betAmount": "number",   // (KO) ë² íŒ… ê¸ˆì•¡ (EN) The bet amount
  "userAddress": "string"  // (KO) ì‚¬ìš©ì ì§€ê°‘ ì£¼ì†Œ (EN) User's wallet address
}
```

**Success Response (Win):**
```json
{
  "success": true,
  "reels": [ ... ],
  "win": true,
  "payout": 100,
  "winTicket": "string", // (KO) JWT ë‹¹ì²¨ í‹°ì¼“ (EN) JWT win ticket
  "serverSeed": "string" // (KO) ê²€ì¦ì„ ìœ„í•œ ì›ë³¸ ì„œë²„ ì‹œë“œ (EN) Original server seed for verification
}
```

**Success Response (Lose):**
```json
{
  "success": true,
  "reels": [ ... ],
  "win": false,
  "payout": 0,
  "serverSeed": "string"
}
```

**Error Response:**
```json
{
  "success": false,
  "errorCode": "INVALID_COMMITMENT | COMMITMENT_NOT_FOUND | INVALID_TRANSACTION | ...",
  "message": "string"
}
```

---

### 7.3. POST /claimPrize

- **(KO) ì„¤ëª…:** ë‹¹ì²¨ í‹°ì¼“ì„ ê²€ì¦í•˜ê³  ì‚¬ìš©ìì—ê²Œ ìƒê¸ˆì„ ì „ì†¡í•©ë‹ˆë‹¤.
- **(EN) Description:** Validates the win ticket and sends the prize to the user.

<<<<<<< HEAD
  - **[ADR-001](https://www.google.com/search?q=./adr/20251008-modernize-ton-library-stack.md):** `tonweb` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì œê±°í•˜ê³  ìµœì‹  `@ton/core` ë° `@ton/ton`ìœ¼ë¡œ ì „í™˜. (EN: Replaced `tonweb` with modern `@ton/core` and `@ton/ton` libraries.)
  - **[ADR-002](https://www.google.com/search?q=./adr/20251008-backend-rpc-proxy-for-get-methods.md):** í´ë¼ì´ì–¸íŠ¸ ì¸¡ RPC í˜¸ì¶œì˜ ì•ˆì •ì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë°±ì—”ë“œ í”„ë¡ì‹œ íŒ¨í„´ ë„ì…. (EN: Introduced a backend proxy pattern to resolve client-side RPC call instability.)
  - **[ADR-003](https://www.google.com/search?q=./adr/20251008-hybrid-dependency-model-for-tonconnect-ui.md):** `@tonconnect/ui`ì˜ ë Œë”ë§ ì•ˆì •ì„±ì„ ìœ„í•´ CDN ê¸°ë°˜ í•˜ì´ë¸Œë¦¬ë“œ ì˜ì¡´ì„± ëª¨ë¸ ì±„íƒ. (EN: Adopted a hybrid CDN-based dependency model for `@tonconnect/ui` rendering stability.)

    - **[ADR-004](./adr/20251010-spin-tx-validation-and-error-logging.md):** (KO) ìŠ¤í•€ íŠ¸ëœì­ì…˜ ì…ë ¥ê°’ ê²€ì¦ ë° ì˜¤ë¥˜ ë¡œê¹… ë¡œì§ ë„ì…. (EN) Introduced validation logic and error logging for spin transaction creation.
=======
**Example Request:**
```bash
curl -X POST https://candlespinner.pages.dev/claimPrize \
  -H "Content-Type: application/json" \
  -d '{
    "winTicket": "eyJhbGci..."
  }'
```

**Request Body:**
```json
{
  "winTicket": "string" // (KO) /revealSpinì—ì„œ ë°œê¸‰ë°›ì€ JWT (EN) JWT received from /revealSpin
}
```

**Success Response:**
```json
{
  "success": true,
  "transaction": {
    "txHash": "string",
    "amount": 100
  }
}
```

**Error Response:**
```json
{
  "success": false,
  "errorCode": "INVALID_TICKET | TICKET_EXPIRED | TICKET_ALREADY_USED | INSUFFICIENT_FUNDS",
  "message": "string"
}
```

---

### 7.4. POST /doubleUp

- **(KO) ì„¤ëª…:** ë”ë¸”ì—… ë¯¸ë‹ˆê²Œì„ì„ ì‹¤í–‰í•˜ê³ , ì„±ê³µ ì‹œ ìƒˆë¡œìš´ ë‹¹ì²¨ í‹°ì¼“ì„ ë°œê¸‰í•©ë‹ˆë‹¤.
- **(EN) Description:** Executes the double-up minigame and issues a new win ticket on success.

**Example Request:**
```bash
curl -X POST https://candlespinner.pages.dev/doubleUp \
  -H "Content-Type: application/json" \
  -d '{
    "winTicket": "eyJhbGci...",
    "choice": "red"
  }'
```

**Request Body:**
```json
{
  "winTicket": "string", // (KO) í˜„ì¬ ë³´ìœ í•œ JWT (EN) The current JWT
  "choice": "red | black" // (KO) ì‚¬ìš©ìì˜ ì„ íƒ (EN) The user's choice
}
```

**Success Response (Win):**
```json
{
  "success": true,
  "win": true,
  "newPayout": 200,
  "newTicket": "string" // (KO) ë‘ ë°°ì˜ ìƒê¸ˆì´ ë‹´ê¸´ ìƒˆë¡œìš´ JWT (EN) New JWT with double the prize
}
```

**Success Response (Lose):**
```json
{
  "success": true,
  "win": false,
  "newPayout": 0
}
```

**Error Response:**
```json
{
  "success": false,
  "errorCode": "INVALID_TICKET | MAX_DOUBLE_UP_REACHED | ...",
  "message": "string"
}
```

---

## 8. Architecture Decision Records (ADR)

| ID | ì œëª© (Title) | ìƒíƒœ (Status) | ìš”ì•½ (Summary) | ì˜í–¥ë°›ëŠ” ê·œì¹™ |
|---|---|---|---|---|
| ADR-001 | Commit-Reveal ë„ì… | âœ… Accepted | (KO) ê²€ì¦ ê°€ëŠ¥í•œ ê³µì •ì„±ì„ ìœ„í•œ Commit-Reveal ìŠ¤í‚´ ë„ì…<br>(EN) Introduced Commit-Reveal scheme for provable fairness | ê·œì¹™ 1 |
| ADR-002 | ë°±ì—”ë“œ RPC í”„ë¡ì‹œ | âŒ Superseded | (KO) í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì£¼ì†Œ ê³„ì‚° ë°©ì‹ì´ ë” ì•ˆì •ì ì´ë¯€ë¡œ í•´ë‹¹ ì•„í‚¤í…ì²˜ëŠ” íê¸°<br>(EN) Discarded as client-side address calculation is more stable | ê·œì¹™ 4 |
| ADR-003 | @tonconnect/ui í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë¸ | âœ… Accepted | (KO) ì´ˆê¸°ì—ëŠ” CDNì„ ì‚¬ìš©í–ˆìœ¼ë‚˜, í˜„ì¬ëŠ” NPM ë°©ì‹ìœ¼ë¡œ ì•ˆì •í™”í•˜ì—¬ ì‚¬ìš©<br>(EN) Initially used CDN, but now stabilized using the NPM method | ê·œì¹™ 3 |
| ADR-004 | ìŠ¤í•€ íŠ¸ëœì­ì…˜ ê²€ì¦ ê°•í™” | âœ… Accepted | (KO) íŠ¸ëœì­ì…˜ ì†Œìœ ê¶Œ ê²€ì¦ ë° ìœ„ì¡° í‹°ì¼“ ë°©ì§€ ë¡œì§ ì¶”ê°€<br>(EN) Added transaction ownership verification and anti-counterfeit ticket logic | ê·œì¹™ 5 |

**ADR íŒŒì¼ ìœ„ì¹˜:** `docs/adr/`
>>>>>>> 51e7e4273b85d9f139be292c0872379e4b88d685
