<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CandleSpinner: TON 슬롯머신 - 프로젝트 설계 문서</title>
    <style>
        :root {
            --bg-color: #1a1a1a; --card-color: #242424; --text-color: #f0f0f0;
            --primary-color: #0088cc; --secondary-color: #4CAF50; --accent-color: #f39c12;
            --subtle-text: #a0a0a0; --border-color: #3a3a3a;
        }
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif; background-color: var(--bg-color);
            color: var(--text-color); margin: 0; padding: 0; line-height: 1.8;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
        header { text-align: center; margin-bottom: 3rem; border-bottom: 1px solid var(--border-color); padding-bottom: 2rem; }
        header h1 { font-size: 2.8rem; color: var(--primary-color); margin: 0; }
        header .version { font-size: 1rem; color: var(--subtle-text); margin-top: 0.5rem; font-family: monospace; }
        
        nav { display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; margin-bottom: 3rem; }
        nav a { color: var(--secondary-color); text-decoration: none; font-weight: 700; font-size: 1.1rem; padding: 0.5rem 1rem; border-radius: 8px; transition: background-color 0.2s; }
        nav a:hover, nav a.active { background-color: var(--card-color); }
        
        .section {
            background-color: var(--card-color); padding: 2.5rem; border-radius: 16px;
            border: 1px solid var(--border-color); margin-bottom: 3rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        .section h2 { font-size: 2rem; color: var(--accent-color); margin-top: 0; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color); }
        .section h3 { font-size: 1.5rem; color: var(--primary-color); margin-top: 2rem; }
        
        ul, ol { padding-left: 20px; }
        li { margin-bottom: 0.8rem; }
        code { background-color: #111; padding: 0.2rem 0.5rem; border-radius: 4px; font-family: monospace; font-size: 0.9em; }
        
        /* User Flow Diagram Styles */
        .flow-diagram { display: flex; flex-direction: column; gap: 1rem; }
        .flow-step { background-color: #1e1e1e; border: 1px solid var(--border-color); padding: 1rem; border-radius: 8px; display: flex; align-items: center; gap: 1rem; }
        .flow-step .actor { font-size: 2rem; }
        .flow-step .description strong { display: block; color: var(--text-color); }
        .flow-step .description span { font-size: 0.9rem; color: var(--subtle-text); }
        .flow-arrow { text-align: center; font-size: 1.5rem; color: var(--accent-color); }

        /* Architecture Diagram Styles */
        .arch-diagram {
            background: #111; padding: 2rem; border-radius: 8px; border: 1px solid var(--border-color);
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; align-items: center; text-align: center;
        }
        .arch-component { background: var(--card-color); padding: 1.5rem; border-radius: 8px; border: 1px solid var(--primary-color); }
        .arch-component h4 { margin: 0 0 0.5rem 0; color: var(--text-color); }
        .arch-component p { font-size: 0.8rem; color: var(--subtle-text); margin: 0; }
        .arch-arrow { font-size: 2rem; color: var(--secondary-color); transform: translateY(20px); }

    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>CandleSpinner: TON 슬롯머신</h1>
            <p class="version">프로젝트 종합 설계 문서 (v1.1.1 기준)</p>
        </header>

        <nav>
            <a href="#overview">프로젝트 개요</a>
            <a href="#srs">요구사항 명세서</a>
            <a href="#user-flow">사용자 흐름도</a>
            <a href="#architecture">시스템 아키텍처</a>
        </nav>

        <!-- Section 1: Project Overview -->
        <section id="overview" class="section">
            <h2>1. 프로젝트 개요</h2>
            <p>
                CandleSpinner는 TON 블록체인 위에서 운영되는 탈중앙화 웹3 슬롯머신 게임입니다. 사용자는 개인 TON 지갑을 직접 연결하여, 게임사가 발행한 고유 토큰(`CSPIN`)으로 베팅하고 실제 상금을 획득할 수 있습니다. 모든 자산 이동은 블록체인에 투명하게 기록되며, 서버는 공정한 게임 결과 생성과 보안에만 집중합니다.
            </p>
            <h3>주요 목표</h3>
            <ul>
                <li><strong>완전한 탈중앙화:</strong> 사용자의 자산은 항상 개인 지갑에 보관되며, 게임사는 자산에 직접 접근할 수 없습니다.</li>
                <li><strong>투명성:</strong> 베팅과 상금 지급 등 모든 핵심 거래는 TON 블록체인에서 확인할 수 있습니다.</li>
                <li><strong>접근성:</strong> 웹 브라우저만 있으면 PC와 모바일 어디서든 별도의 설치 없이 플레이할 수 있습니다.</li>
                <li><strong>저비용 운영:</strong> Cloudflare Pages의 서버리스 아키텍처를 통해 고정 서버 비용 없이 운영됩니다.</li>
            </ul>
        </section>

        <!-- Section 2: Software Requirements Specification (SRS) -->
        <section id="srs" class="section">
            <h2>2. 소프트웨어 요구사항 명세서 (SRS)</h2>
            <h3>기능적 요구사항</h3>
            <ol>
                <li><strong>지갑 연결:</strong>
                    <ul>
                        <li>사용자는 `TON Connect`를 통해 자신의 TON 지갑을 게임에 연결할 수 있어야 한다.</li>
                        <li>PC 환경에서는 QR코드를, 모바일 환경에서는 설치된 지갑 앱으로 직접 연결을 지원해야 한다.</li>
                    </ul>
                </li>
                <li><strong>게임 플레이:</strong>
                    <ul>
                        <li>게임 화면은 3x3 그리드 형태의 9개 릴로 구성된다.</li>
                        <li>사용자는 베팅 금액(`CSPIN` 토큰)을 조절할 수 있어야 한다.</li>
                        <li>`SPIN` 버튼을 누르면, 베팅액만큼의 토큰을 지불하고 릴이 돌아가는 애니메이션이 표시된다.</li>
                    </ul>
                </li>
                <li><strong>블록체인 거래:</strong>
                    <ul>
                        <li>베팅은 사용자가 직접 서명하는 토큰 전송(Jetton Transfer) 트랜잭션을 통해 이루어진다.</li>
                        <li>게임사는 사용자의 `TON` 코인 잔액을 확인하여 최소 가스비 보유 여부를 안내해야 한다.</li>
                        <li>(향후) 당첨 시, 백엔드 서버는 게임 지갑에서 사용자 지갑으로 상금 토큰을 자동으로 전송해야 한다.</li>
                    </ul>
                </li>
            </ol>
            <h3>비기능적 요구사항</h3>
            <ul>
                <li><strong>보안:</strong> 게임 지갑의 개인키는 코드에 노출되지 않으며, Cloudflare의 암호화된 환경 변수를 통해 안전하게 관리되어야 한다.</li>
                <li><strong>성능:</strong> 페이지 로딩과 릴 애니메이션은 지연 없이 부드럽게 작동해야 한다.</li>
                <li><strong>비용:</strong> Cloudflare Pages의 무료 등급(Free Tier) 내에서 모든 기능이 운영 가능해야 한다.</li>
            </ul>
        </section>

        <!-- Section 3: User Flow Diagram -->
        <section id="user-flow" class="section">
            <h2>3. 사용자 흐름도</h2>
            <p>사용자가 게임에 접속해서 스핀을 완료하기까지의 전체 과정입니다.</p>
            <div class="flow-diagram">
                <div class="flow-step">
                    <div class="actor">👤</div>
                    <div class="description"><strong>1. 사이트 접속</strong><span>사용자가 `aiandyou.me`에 접속하여 랜딩 페이지를 확인한다.</span></div>
                </div>
                <div class="flow-arrow">⬇</div>
                <div class="flow-step">
                    <div class="actor">👤</div>
                    <div class="description"><strong>2. 지갑 연결 시도</strong><span>'Connect Wallet' 버튼을 클릭한다. (PC/모바일 환경에 따라 다른 UI 표시)</span></div>
                </div>
                <div class="flow-arrow">⬇</div>
                <div class="flow-step">
                    <div class="actor">📱</div>
                    <div class="description"><strong>3. 지갑 앱에서 승인</strong><span>자동으로 열린 지갑 앱(Tonkeeper 등)에서 사이트 연결 요청을 확인하고 승인한다.</span></div>
                </div>
                <div class="flow-arrow">⬇</div>
                 <div class="flow-step">
                    <div class="actor">💻</div>
                    <div class="description"><strong>4. 게임 화면 진입</strong><span>연결이 성공하면, 사용자의 지갑 주소가 표시된 메인 게임 화면으로 전환된다.</span></div>
                </div>
                <div class="flow-arrow">⬇</div>
                <div class="flow-step">
                    <div class="actor">👤</div>
                    <div class="description"><strong>5. 스핀 실행</strong><span>베팅액을 설정하고 'SPIN' 버튼을 클릭한다.</span></div>
                </div>
                <div class="flow-arrow">⬇</div>
                 <div class="flow-step">
                    <div class="actor">🔗</div>
                    <div class="description"><strong>6. 베팅 거래 승인</strong><span>지갑 앱에서 `CSPIN` 토큰 전송(베팅) 거래를 최종 승인한다.</span></div>
                </div>
                <div class="flow-arrow">⬇</div>
                <div class="flow-step">
                    <div class="actor">🎰</div>
                    <div class="description"><strong>7. 결과 확인</strong><span>거래가 블록체인에서 확인된 후, 릴 애니메이션과 최종 게임 결과를 확인한다.</span></div>
                </div>
            </div>
        </section>

        <!-- Section 4: System Architecture -->
        <section id="architecture" class="section">
            <h2>4. 시스템 아키텍처</h2>
            <p>우리 게임은 프론트엔드, 백엔드, 블록체인이 유기적으로 상호작용하는 서버리스 아키텍처로 구성됩니다.</p>
            <div class="arch-diagram">
                <div class="arch-component">
                    <h4>👤 사용자 브라우저</h4>
                    <p><strong>(프론트엔드)</strong></p>
                    <p>HTML / CSS / JS</p>
                    <p>TON Connect, TonWeb</p>
                </div>
                <div class="arch-arrow">↔</div>
                <div class="arch-component">
                    <h4>☁️ Cloudflare Pages</h4>
                    <p><strong>(호스팅 & 백엔드)</strong></p>
                    <p>정적 파일 서빙 (`/public`)</p>
                    <p>서버리스 API (`/functions`)</p>
                </div>
                 <div class="arch-arrow">↔</div>
                 <div class="arch-component">
                    <h4>🔗 TON 블록체인</h4>
                    <p><strong>(데이터 & 원장)</strong></p>
                    <p>지갑 잔액 조회</p>
                    <p>토큰 거래 기록</p>
                </div>
            </div>
            <h3>데이터 흐름 설명</h3>
            <ol>
                <li>사용자의 브라우저는 <strong>Cloudflare Pages</strong>에서 웹사이트 파일(`index.html` 등)을 받아와 화면에 표시합니다.</li>
                <li>`SPIN` 버튼을 누르면, 브라우저는 <strong>TON 블록체인</strong>과 직접 통신하여 토큰 거래를 생성하고 사용자의 승인을 받습니다.</li>
                <li>거래가 성공하면, 브라우저는 <strong>Cloudflare Functions</strong>로 구현된 백엔드 API (`/spin`)에 게임 결과 계산을 요청합니다.</li>
                <li>(향후) 백엔드 함수는 당첨 시, <strong>TON 블록체인</strong>에 상금 지급 거래를 전송합니다.</li>
            </ol>
        </section>

    </div>
</body>
</html>
